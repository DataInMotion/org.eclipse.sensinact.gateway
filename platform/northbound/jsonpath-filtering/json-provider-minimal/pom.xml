<!--
  ~ Copyright (c) 2017 CEA.
  ~ All rights reserved. This program and the accompanying materials
  ~ are made available under the terms of the Eclipse Public License v1.0
  ~ which accompanies this distribution, and is available at
  ~ http://www.eclipse.org/legal/epl-v10.html
  ~
  ~ Contributors:
  ~    CEA - initial API and implementation
  -->

<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
	<modelVersion>4.0.0</modelVersion>

	<parent>
		<groupId>org.eclipse.sensinact.gateway.nthbnd</groupId>
		<artifactId>jsonpath-filtering</artifactId>
		<version>1.5-SNAPSHOT</version>
	</parent>

    <artifactId>json-provider-minimal</artifactId>

	<name>sensiNact IoT Gateway - JsonPath Provider </name>
	<packaging>bundle</packaging>
		
    <dependencies> 
        <dependency>
            <groupId>org.slf4j</groupId>
            <artifactId>slf4j-api</artifactId>
            <version>1.7.25</version>
            <scope>provided</scope>
        </dependency>       
		<dependency>
			<groupId>org.json</groupId>
			<artifactId>json</artifactId>
			<version>20080701</version>
			<scope>provided</scope>
		</dependency>
		<dependency>
			<groupId>org.assertj</groupId>
			<artifactId>assertj-core</artifactId>
			<version>2.1.0</version>
			<scope>test</scope>
		</dependency>
		<dependency>
			<groupId>org.hamcrest</groupId>
			<artifactId>hamcrest-core</artifactId>
			<version>1.3</version>
			<scope>test</scope>
		</dependency>
		<dependency>
			<groupId>org.hamcrest</groupId>
			<artifactId>hamcrest-library</artifactId>
			<version>1.3</version>
			<scope>test</scope>
		</dependency>
		<dependency>
			<groupId>commons-io</groupId>
			<artifactId>commons-io</artifactId>
			<version>2.4</version>
			<scope>test</scope>
		</dependency>
		<dependency>
			<groupId>org.slf4j</groupId>
			<artifactId>slf4j-simple</artifactId>
			<version>1.7.16</version>
			<scope>test</scope>
		</dependency>
		<dependency>
			<groupId>junit</groupId>
			<artifactId>junit</artifactId>
			<version>4.12</version>
			<scope>test</scope>
		</dependency>
    </dependencies>
    
	<build>
        <plugins>			
	        <plugin>
	          <groupId>org.codehaus.gmaven</groupId>
	          <artifactId>groovy-maven-plugin</artifactId>
	          <executions>
	            <execution>
	              <id>search-dependency</id>
	              <phase>validate</phase>
	              <goals>
	                <goal>execute</goal>
	              </goals>
	              <configuration>
	                <defaults>
	                  <name>search-dependency</name>
	                </defaults>
	                <source>
		                String basedir = project.basedir.absolutePath.replace('\\','/');	                
		                File dependencyFile = new File(new File(basedir).getParentFile(), "json-path/target/json-path-2.4.0.jar");	
		                
		                if(!dependencyFile.exists())
		                {	              	
		                	project.getCompileSourceRoots().clear();
		                	project.getTestCompileSourceRoots().clear();
		                	
		                	
		                	org.apache.maven.plugin.internal.DefaultPluginManager 
		                	manager = session.getContainer().lookup(
		                	org.apache.maven.plugin.PluginManager.class.getName());
		                	
		                	log.info('{}',manager);
		                	
		                } else
		                {   
		                	org.apache.maven.artifact.Artifact artifact = 
		                	new  org.apache.maven.artifact.DefaultArtifact('com.jayway.jsonpath',
		                	'json-path', 
		                	 org.apache.maven.artifact.versioning.VersionRange.createFromVersionSpec('2.4.0'),
		                	 org.apache.maven.artifact.Artifact.SCOPE_SYSTEM,
		                	 'jar', '', 
                             new org.apache.maven.artifact.handler.DefaultArtifactHandler('jar')
                             {
                             	@Override
                             	public boolean isAddedToClasspath()
    							{
        							return true;
    							}
    							
    							@Override
							    public boolean isIncludesDependencies()
							    {
							        return true;
							    }							    
    							
    							@Override
							    public String getDirectory()
							    {
							        return dependencyFile.getParentFile().getAbsolutePath();
							    }
                             },
                             false);                      
                             artifact.setFile(dependencyFile);                             
                             project.getDependencyArtifacts().add(artifact); 
		                }
	                </source>
	              </configuration>
	            </execution>
	          </executions>
	        </plugin>	        
	        <plugin>
	        	<artifactId>maven-compiler-plugin</artifactId>
	        	<configuration>
	        		<source>1.7</source>
	        		<target>1.7</target>
	        	</configuration>
	        </plugin>
            <plugin>
              <groupId>org.apache.felix</groupId>
              <artifactId>maven-bundle-plugin</artifactId>
              <extensions>true</extensions>
              <configuration>
                 <instructions>  
                    <Bundle-SymbolicName>${project.artifactId}</Bundle-SymbolicName>
                    <Bundle-Name>${project.name}</Bundle-Name>
                    <Bundle-Vendor>Eclipse</Bundle-Vendor>
                    <Build-By>Eclipse</Build-By>
                    <Bundle-Description>${project.name}</Bundle-Description>
                    <_nouses>true</_nouses>
                    <_failok>true</_failok>
                	<_noee>true</_noee>
                    <Fragment-Host>com.jayway.jsonpath.json-path</Fragment-Host>
                    <Provide-Capability>json-path-provider</Provide-Capability> 
 					<Export-Package></Export-Package>
                 </instructions>
              </configuration>
           </plugin>
    	</plugins>
    </build>
</project>
